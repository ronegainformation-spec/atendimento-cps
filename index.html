<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta name="robots" content="noindex, nofollow">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Central de Comando - CPS</title>
    <style>
        :root { 
            --red: #b30000; 
            --gold: #f1c40f; 
            --bg: #f4f4f4; 
            --dark: #1a1a1a; 
            --orange: #e67e22; 
            --green: #27ae60; 
            --blue: #2980b9; 
        }
        
        body { 
            font-family: 'Segoe UI', sans-serif; 
            margin: 0; 
            background: var(--bg); 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            min-height: 100vh;
            visibility: hidden; 
            padding-bottom: 70px; /* Espa√ßo para o rodap√© fixo */
        }

        #user-bar {
            width: 100%;
            background: var(--dark);
            color: white;
            padding: 8px 20px;
            font-size: 0.8rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-sizing: border-box;
        }

        .btn-logout {
            background: #444;
            color: white;
            border: none;
            padding: 5px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.7rem;
            transition: 0.3s;
        }

        .btn-logout:hover { background: var(--red); }

        .header { 
            background: white; 
            width: 100%; 
            padding: 20px 0; 
            text-align: center; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-bottom: 5px solid var(--red);
        }

        .logo-painel { max-width: 180px; margin-bottom: 10px; }

        .container { 
            max-width: 1100px; 
            width: 95%; 
            margin-top: 30px; 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 15px; 
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            transition: 0.3s;
            cursor: pointer;
            border: 1px solid #ddd;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            min-height: 240px;
        }

        .card:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(0,0,0,0.1); border-color: var(--red); }
        .card h3 { margin: 10px 0; color: var(--dark); font-size: 1.1rem; }
        .card p { color: #666; font-size: 0.8rem; margin: 0; flex-grow: 1; }

        .btn-acesso {
            margin-top: 15px;
            padding: 10px;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.7rem;
            cursor: pointer;
            width: 100%;
            color: white;
            transition: 0.2s;
        }

        .btn-public { background: var(--dark); }
        .btn-adm { background: var(--red); }
        .btn-mobile { background: var(--green); }
        .btn-print { background: var(--orange); }
        .btn-config { background: var(--blue); }

        .badge-lock {
            font-size: 0.6rem;
            background: #eee;
            padding: 4px 8px;
            border-radius: 4px;
            margin-top: 8px;
            color: #888;
        }

        /* RODAP√â PADRONIZADO RONEGA INFOSEC */
        .rodape-global {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: var(--dark);
            color: #aaa;
            text-align: center;
            padding: 12px 0;
            font-size: 11px;
            border-top: 3px solid var(--red);
            z-index: 1000;
        }

        .rodape-global strong { color: white; }
        .rodape-global a { color: #25D366; text-decoration: none; margin-left: 10px; }
        
    </style>
</head>
<body>

<div id="user-bar">
    <span>Conectado como: <strong id="user-email">...</strong></span>
    <button class="btn-logout" id="logout-trigger">SAIR DO SISTEMA</button>
</div>

<div class="header">
    <img src="logo-cps.png" alt="Logo CPS" class="logo-painel">
    <h2 style="color: var(--red); margin: 0; font-size: 1.5rem;">SISTEMA INTEGRADO DE ATENDIMENTO</h2>
</div>

<div class="container">

    <div class="card" onclick="irPara('tv.html')">
        <div style="font-size: 40px;">üì∫</div>
        <h3>PAINEL DA TV</h3>
        <p>Exibi√ß√£o das chamadas e alertas sonoros.</p>
        <button class="btn-acesso btn-public">ABRIR P√ÅGINA</button>
    </div>
    
    <div class="card" onclick="irPara('totem.html')">
        <div style="font-size: 40px;">üé´</div>
        <h3>TOTEM DE SENHAS</h3>
        <p>Emiss√£o de senhas f√≠sicas para a recep√ß√£o.</p>
        <button class="btn-acesso btn-public">ABRIR P√ÅGINA</button>
    </div>

    <div class="card" onclick="irPara('mobile.html')">
        <div style="font-size: 40px;">üì±</div>
        <h3>SENHA DIGITAL</h3>
        <p>Vers√£o mobile para retirada via smartphone.</p>
        <button class="btn-acesso btn-mobile">ABRIR VERS√ÉO MOBILE</button>
    </div>
    
    <div class="card" onclick="irPara('personalizado.html')">
        <div style="font-size: 40px; color: #b30000;">‚ö°</div>
        <h3>SENHA ESPECIAL</h3>
        <p>Emiss√£o manual para conting√™ncia ou prioridades.</p>
        <button class="btn-acesso btn-adm">SENHAS ESPECIAIS</button>
    </div>

    <div class="card" onclick="abrirJanela('qrcode.html')">
        <div style="font-size: 40px;">üñ®Ô∏è</div>
        <h3>CARTAZ QR CODE</h3>
        <p>Imprimir cartaz de instru√ß√£o para os alunos.</p>
        <button class="btn-acesso btn-print">GERAR IMPRESS√ÉO</button>
    </div>
    
    <div class="card" onclick="irPara('atendimento.html')">
        <div style="font-size: 40px;">üéß</div>
        <h3>PAINEL ATENDENTE</h3>
        <p>Controle de chamadas e hist√≥rico di√°rio.</p>
        <span class="badge-lock">üîì ACESSO RESTRITO</span>
        <button class="btn-acesso btn-public">ACESSAR PAINEL</button>
    </div>

    <div class="card" onclick="validarAdm('admin_users.html')">
        <div style="font-size: 40px;">üë•</div>
        <h3>GERENCIAR USU√ÅRIOS</h3>
        <p>Criar e remover acessos de atendentes.</p>
        <span class="badge-lock">üîí SOMENTE ADMIN</span>
        <button class="btn-acesso btn-adm">GERENCIAR</button>
    </div>

    <div class="card" onclick="validarAdm('gerenciar_adms.html')">
        <div style="font-size: 40px;">üõ†Ô∏è</div>
        <h3>GERENCIAR ADMS</h3>
        <p>Gerenciar privil√©gios de Administrador.</p>
        <span class="badge-lock">üîí SOMENTE SUPER ADMIN</span>
        <button class="btn-acesso btn-config">CONFIGURAR</button>
    </div>
</div>

<footer class="rodape-global">
    Desenvolvido por <strong>Ronega Information Security</strong> | CPS &copy; 2025
    <a href="https://wa.me/5511954991772" target="_blank">üí¨ Suporte</a>
</footer>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAwpjh0QNhJEHowt-04PHUN_3-1XlrCgKg",
        authDomain: "sistemacps-743f3.firebaseapp.com",
        databaseURL: "https://sistemacps-743f3-default-rtdb.firebaseio.com",
        projectId: "sistemacps-743f3",
        storageBucket: "sistemacps-743f3.firebasestorage.app",
        messagingSenderId: "127411684616",
        appId: "1:127411684616:web:e3c9abb4d19287e5a818bd"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);

    let usuarioLogado = null;
    let listaAdms = [];

    onAuthStateChanged(auth, (user) => {
        if (!user) {
            window.location.href = "login.html";
        } else {
            usuarioLogado = user;
            document.getElementById('user-email').innerText = user.email;
            document.body.style.visibility = "visible"; 

            onValue(ref(db, 'administradores'), (snapshot) => {
                const data = snapshot.val();
                listaAdms = data ? Object.values(data).map(a => a.email.toLowerCase()) : [];
            });
        }
    });

    document.getElementById('logout-trigger').addEventListener('click', () => {
        if(confirm("Deseja realmente sair do sistema?")) {
            signOut(auth).then(() => {
                window.location.href = "login.html";
            });
        }
    });

    window.irPara = (url) => { if(usuarioLogado) window.location.href = url; };
    window.abrirJanela = (url) => { window.open(url, '_blank'); };

    window.validarAdm = (url) => {
        const emailLogado = usuarioLogado.email.toLowerCase();
        if (usuarioLogado && listaAdms.includes(emailLogado)) {
            window.location.href = url;
        } else {
            alert("ACESSO NEGADO: Voc√™ n√£o tem permiss√£o de Administrador.");
        }
    };
</script>
</body>
</html>