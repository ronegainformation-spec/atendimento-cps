<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Painel de Senhas CPS</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { --cps-red: #b30000; --gold: #f39c12; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; display: grid; grid-template-columns: 1fr 350px; height: 100vh; background: #eee; }
        .tv-view { background: #222; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: 0.5s; }
        .is-p { background: var(--gold) !important; color: black !important; }
        #display-senha { font-size: 16rem; font-weight: 900; color: var(--cps-red); background: white; padding: 20px 100px; border-radius: 30px; box-shadow: 0 15px 50px rgba(0,0,0,0.5); }
        .admin-panel { background: white; padding: 30px; border-left: 6px solid var(--cps-red); box-shadow: -5px 0 15px rgba(0,0,0,0.1); }
        button { width: 100%; padding: 20px; margin: 10px 0; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 1.1rem; transition: 0.3s; }
        .btn-n { background: var(--cps-red); color: white; }
        .btn-p { background: var(--gold); color: white; }
        .btn-audio { background: #444; color: white; margin-bottom: 20px; }
    </style>
</head>
<body>

<div class="tv-view" id="tela">
    <div style="font-size: 2.5rem; margin-bottom: 20px; letter-spacing: 5px;">SENHA ATUAL</div>
    <div id="display-senha">---</div>
    <div id="tipo-txt" style="margin-top: 20px; font-size: 1.5rem; opacity: 0.8;">Aguardando...</div>
</div>

<div class="admin-panel">
    <img src="https://www.cps.sp.gov.br/wp-content/themes/centro-paula-souza/assets/images/logo-cps.png" width="150">
    <button class="btn-audio" onclick="ativarSom()">ðŸ”Š ATIVAR SOM (TV)</button>
    <hr>
    <h3>CONTROLE</h3>
    <button class="btn-n" onclick="chamar('N')">CHAMAR NORMAL (N)</button>
    <button class="btn-p" onclick="chamar('P')">CHAMAR PRIORIDADE (P)</button>
    <button style="background:#3498db; color:white;" onclick="repetir()">REPETIR CHAMADA</button>
    <button style="background:#ddd; font-size:0.8rem;" onclick="resetar()">RESETAR TUDO</button>
</div>

<script>
    const config = { databaseURL: https://console.firebase.google.com/project/sistemacps-743f3/database/sistemacps-743f3-default-rtdb/data/~2F?hl=pt-BR };
    firebase.initializeApp(config);
    const db = firebase.database();

    // OUVIR MUDANÃ‡AS (Para a TV)
    db.ref('chamada_ativa').on('value', snap => {
        const dados = snap.val();
        if(dados) {
            document.getElementById('display-senha').innerText = dados.senha;
            document.getElementById('tipo-txt').innerText = dados.tipo === 'P' ? 'ATENDIMENTO PRIORITÃRIO' : 'ATENDIMENTO NORMAL';
            document.getElementById('tela').className = 'tv-view ' + (dados.tipo === 'P' ? 'is-p' : '');
            falar(dados.senha, dados.tipo);
        }
    });

    function chamar(tipo) {
        db.ref('contadores_chamada/' + tipo).transaction(c => (c || 0) + 1, (err, comm, snap) => {
            const senha = tipo + snap.val().toString().padStart(3, '0');
            db.ref('chamada_ativa').set({ senha: senha, tipo: tipo, t: Date.now() });
        });
    }

    function repetir() { db.ref('chamada_ativa/t').set(Date.now()); }
    function falar(s, t) {
        const m = new SpeechSynthesisUtterance((t==='P'?'Prioridade, senha ':'Senha ') + s.split('').join(' '));
        m.lang = 'pt-BR'; window.speechSynthesis.speak(m);
    }
    function ativarSom() { window.speechSynthesis.speak(new SpeechSynthesisUtterance("Som ativado")); }
    function resetar() { if(confirm("Zerar?")) db.ref('/').remove(); }
</script>
</body>
</html>
