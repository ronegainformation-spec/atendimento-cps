<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Totem de Senhas - CPS</title>
    <style>
        body { font-family: sans-serif; background: #f4f4f4; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .box { background: white; padding: 40px; border-radius: 30px; text-align: center; box-shadow: 0 20px 40px rgba(0,0,0,0.15); width: 400px; border-top: 15px solid #b30000; }
        button { width: 100%; padding: 30px; margin: 15px 0; font-size: 1.6rem; font-weight: bold; border: none; border-radius: 15px; cursor: pointer; color: white; transition: 0.2s; }
        .btn-n { background: #b30000; box-shadow: 0 8px 0 #700; }
        .btn-p { background: #f1c40f; color: black; box-shadow: 0 8px 0 #987d0e; }
        button:active { transform: translateY(4px); box-shadow: 0 2px 0 #333; }
        @media print { body * { visibility: hidden; } #ticket { visibility: visible; position: absolute; left:0; top:0; width:100%; text-align:center; } }
        #ticket { display: none; font-family: 'Courier New', monospace; border: 1px dashed #000; padding: 20px; }
    </style>
</head>
<body>

<div class="box">
    <img src="https://fatecead.com.br/wp-content/uploads/2021/01/logo-cps.png" width="180">
    <h2 style="color: #333; margin: 30px 0;">Retire sua Senha:</h2>
    <button class="btn-n" onclick="gerar('N')">ATENDIMENTO NORMAL</button>
    <button class="btn-p" onclick="gerar('P')">PRIORITÁRIO</button>
</div>

<div id="ticket">
    <h2>CENTRO PAULA SOUZA</h2>
    <hr>
    <h1 id="s-num" style="font-size: 4rem; margin: 10px 0;">---</h1>
    <p id="s-tipo" style="font-size: 1.5rem; font-weight: bold;"></p>
    <p id="s-data"></p>
    <hr>
    <p>Por favor, aguarde o painel.</p>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getDatabase, ref, runTransaction } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAwpjh0QNhJEHowt-04PHUN_3-1XlrCgKg",
        authDomain: "sistemacps-743f3.firebaseapp.com",
        databaseURL: "https://sistemacps-743f3-default-rtdb.firebaseio.com",
        projectId: "sistemacps-743f3",
        storageBucket: "sistemacps-743f3.firebasestorage.app",
        messagingSenderId: "127411684616",
        appId: "1:127411684616:web:e3c9abb4d19287e5a818bd"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    window.gerar = (tipo) => {
        const refTotem = ref(db, 'contadores/totem_' + tipo);
        runTransaction(refTotem, (current) => {
            return (current || 0) + 1;
        }).then((result) => {
            const num = result.snapshot.val().toString().padStart(3, '0');
            const senha = tipo + num;
            
            document.getElementById('s-num').innerText = senha;
            document.getElementById('s-tipo').innerText = tipo === 'N' ? 'NORMAL' : 'PRIORITÁRIO';
            document.getElementById('s-data').innerText = new Date().toLocaleString();
            window.print();
        });
    };
</script>
</body>
</html>